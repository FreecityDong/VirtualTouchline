# 项目全流程（需求挖掘 -> 完成）

- 需求挖掘
  - 业务目标
    - 打造可实时操控的虚拟足球教练系统（阵型 + 策略 + 推演 + AI解说）
    - 降低战术推演门槛，提高训练/解说/复盘效率
    - 支持中场与终场自动生成中文战术分析报告
  - 用户画像
    - 足球教练/助教：关注阵型效果、调整时机、执行结果
    - 解说与内容创作者：关注过程叙事、事件链、战术亮点
    - 学生/球迷：关注可视化理解、互动学习、结果解释
  - 场景与痛点
    - 赛前：缺少快速验证阵型策略组合的工具
    - 赛中：战术调整难量化，决策依据不透明
    - 赛后：复盘依赖人工总结，耗时且不一致
  - 竞品与约束
    - 竞品：传统战术板、统计平台、视频分析工具（互动性弱或学习门槛高）
    - 约束：桌面端实时性、手势识别稳定性、模型调用时延与成本
  - 可行性评估
    - 技术可行：MediaPipe + OpenCV（手势），Tkinter（看板），状态机（仿真），DeepSeek（分析）
    - 工程可行：已完成模拟器与手势 UI，可分阶段融合
    - 业务可行：先服务训练与教学，再扩展解说和内容生产
- 需求分析
  - 需求分级
    - P0：比赛状态机推演、阵型策略调整、日志与看板、AI中场/终场报告
    - P1：手势拖拽球员、A/B 队联动、头像与阵型动画
    - P2：语音策略强度识别、观众反馈生成、多模态解说
  - 需求范围
    - 11v11 常见阵型库 + 三组策略（高度/节奏/主攻通道）
    - 事件机制：推进、失误、出界、角球、任意球、点球、射门结果
    - 可解释输出：过程日志 + 专业统计 + AI战术报告
  - 验收标准
    - 每个时间片状态流转与球权逻辑正确
    - 阵型/策略调整次数限制生效（每15分钟窗口）
    - 中场/终场自动触发分析并弹窗展示，15秒后隐藏
    - 报告中文可读、结构化、可执行
  - PRD/用户故事
    - 作为教练，我希望在比赛窗口内调整阵型策略并立即看到影响
    - 作为解说，我希望获取关键过程摘要并自动生成战术解读
    - 作为学习者，我希望通过可视化区域与球权变化理解攻防转换
- 方案设计
  - 信息架构
    - 左侧：比赛过程日志（可筛选）
    - 右侧：比分、时间、区域球权图、统计、8维评分、调整控件
    - 弹窗：中场/终场战术分析报告
  - 原型与交互
    - 手势交互：抓取/移动/放开/确认（OK）
    - 调整约束：阵型与策略按窗口次数限制
    - 视觉反馈：选中高亮、抓取放大、阵型切换动画
  - 技术选型
    - Python 3.11
    - Tkinter（主看板 UI）
    - OpenCV + MediaPipe Hands（手势）
    - OpenAI SDK + 阿里云百炼 DeepSeek 兼容接口（分析）
  - 系统架构
    - 交互层：手势与控件输入
    - 仿真层：`MatchSimulatorEngine`（状态机、统计、事件历史）
    - 分析层：上下文压缩 + 大模型报告生成
    - 展示层：日志、看板、弹窗
  - 数据与接口
    - 核心数据：阵型8维基础值、策略增量、路线倾向、事件历史、阶段KPI
    - 上下文接口：`build_deepseek_prompt_payload()`
    - 外部接口：`/compatible-mode/v1/chat/completions`
- 计划管理
  - 里程碑
    - M1：模拟器闭环（状态机 + 看板 + 调整规则）
    - M2：手势交互闭环（A/B 队阵型动画与操作约束）
    - M3：AI 分析闭环（中场/终场自动触发与展示）
    - M4：融合联调与稳定性优化
  - 排期与资源
    - 开发：仿真 40%，交互 35%，AI分析 25%
    - 测试：规则回归 + 交互稳定 + 模型输出质量
  - 风险清单
    - 手势误识别导致误操作
    - 模型响应慢或输出不稳定
    - 状态机规则扩展后一致性回归风险
  - 成本预算
    - 模型调用成本：中场 + 终场 2 次/场
    - 设备成本：摄像头与本地算力
- 研发实现
  - 环境与基建
    - 独立虚拟环境（如 `.venv_gesture`）
    - 依赖管理（`requirements.txt`）
    - 日志与配置分离（API Key 用环境变量优先）
  - 模块拆解
    - `match_state_machine_simulator.py`：比赛状态机与看板
    - `gesture_formation_interaction.py`：手势阵型交互
    - `test_deepseek_call.py`：模型调用与输出验证
  - 核心功能开发
    - 7x3 区域球权映射与攻防推进逻辑
    - 事件判定与结果回流（含定位球重启）
    - 阵型/策略控制与窗口配额机制
    - AI 上下文压缩（timeline digest）与报告触发
  - 集成与联调
    - 触发对齐：中场暂停、终场结束、弹窗展示
    - 数据对齐：日志、统计、AI输入一致
    - 交互对齐：手势确认前后与对手变阵协同
  - 文档与规范
    - 数据模型文档（状态机版）
    - 部署文档、运行手册、问题排查手册
- 测试验证
  - 单元测试
    - 区域转换、失误镜像、定位球回流、统计累加
  - 集成测试
    - 自动推进与手动推进一致性
    - 中场/终场触发与弹窗生命周期
  - 性能与安全
    - UI 主线程不卡顿（模型调用异步）
    - API Key 安全（环境变量优先，避免硬编码外泄）
  - 验收测试
    - 一场完整90分钟模拟可稳定跑通
    - 中场与终场报告都能自动生成并可读
- 发布上线
  - 发布策略
    - 本地单机版先行，后续扩展服务化
  - 灰度与回滚
    - 模型开关可控（失败可降级为模板报告）
  - 监控与告警
    - 记录模型调用时延、失败率、重试次数
  - 运行手册
    - 一键启动、环境检查、常见报错处理
- 运营迭代
  - 数据复盘
    - 每场输出关键事件与报告质量反馈
  - 用户反馈
    - 教练可读性、建议可执行性、交互流畅度
  - 体验优化
    - 报告格式优化（缩进、分块、长度控制）
    - 手势识别容错与误触优化
  - 版本迭代
    - 语音强度识别接入
    - 观众/解说 AIGC 内容扩展
    - Web 化与多人协同版本
